<?xml version="1.0" encoding="UTF-8"?>
<entity-mappings xmlns="https://jakarta.ee/xml/ns/persistence/orm" version="3.0">
<!-- 이게 없어도 findBy** 는 작동하는데, 명시적으로 쿼리를 지정하고 싶을 때 사용
    <named-query name="Question.findById">
        <query>
            SELECT q 
            FROM Question q 
            WHERE 1=1
                and q.id = :id
        </query>
    </named-query> 
-->

    <named-query name="Question.findAllByKeyword">
        <query>
            select
                distinct q
                from Question q
                left outer join SiteUser u1 on q.author=u1
                left outer join Answer a on a.question=q
                left outer join SiteUser u2 on a.author=u2
                where 1=1
                    and (q.subject like concat('%', :kw, '%')
                        or q.content like concat('%', :kw, '%')
                        or u1.username like concat('%', :kw, '%')
                        or a.content like concat('%', :kw, '%')
                        or u2.username like concat('%', :kw, '%')
                    )
        </query>
    </named-query>

</entity-mappings>